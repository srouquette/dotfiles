#!/usr/bin/env bash
set -eufo pipefail

# only initialize as root
{{ if eq .chezmoi.username "root" -}}

pacman-key --init
pacman-key --populate
pacman -Sy --noconfirm archlinux-keyring
pacman -Su --noconfirm

echo "%wheel ALL=(ALL) ALL" > /etc/sudoers.d/wheel
useradd --create-home --user-group -G wheel --shell /bin/zsh {{ .username }} &> /dev/null

echo 'root password:'
passwd
echo '{{ .username }} password:'
passwd {{ .username }}
{{ end -}}
